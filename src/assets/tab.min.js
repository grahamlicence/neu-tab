/*! Neu-tab 2014-02-12 10:58 */
var Tab={};Tab.showTime=function(){"use strict";var a=document.createElement("p"),b=function(){var b=new Date,c=b.getHours(),d=b.getMinutes(),e=b.getSeconds();10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),a.innerHTML='<span class="bk">'+c+'</span>:<span class="bk">'+d+'</span>:<span class="bk">'+e+"</span>"};a.className="current-time",document.getElementsByTagName("body")[0].insertBefore(a),setInterval(b,500),b()},Tab.locationData=function(){"use strict";function a(){f.className="current-location",document.getElementsByTagName("body")[0].insertBefore(f),f.innerHTML=d.address_components[1].long_name+", "+d.address_components[2].long_name}function b(a){if(null===a.query)return void c();var b,d=a.query.results.channel;g.className="weather-forecast",document.getElementsByTagName("body")[0].insertBefore(g),console.log(d),b="<p>Sunset: "+d.astronomy.sunset+"</p>",b+='<p class="weather-now">'+d.item.condition.temp+"&deg;"+d.units.temperature+" "+d.item.condition.text+"</p>",b+='<ul class="forecast">',_.each(d.item.forecast,function(a){b+='<li title="'+a.date+'"><p>'+a.day+"</p><p>High: "+a.high+"&deg;"+d.units.temperature+"</p><p>Low:  "+a.low+"&deg;"+d.units.temperature+"</p><p>"+a.text+"</p>"}),g.innerHTML=b}function c(){var a;a=new XMLHttpRequest;var c="%20AND%20u%3D'c'";a.open("GET","http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%3D"+e+c+"&format=json&diagnostics=true&callback=",!0),a.onload=function(){if(a.status>=200&&a.status<400){var c=JSON.parse(a.responseText);localStorage.setItem("weatherUpdate",Date.now()),localStorage.setItem("weatherData",JSON.stringify(c)),b(c)}else console.log("error on load")},a.onerror=function(){console.log("connection error")},a.send()}var d=JSON.parse(localStorage.getItem("location")),e=localStorage.getItem("woeid"),f=document.createElement("p"),g=document.createElement("div");console.log(d),a();var h=parseInt(localStorage.getItem("weatherUpdate"),10);Date.now()-h>72e5?c():b(JSON.parse(localStorage.getItem("weatherData")))},Tab.getLocation=function(){"use strict";if("geolocation"in navigator!=!1){var a,b=parseFloat(localStorage.getItem("lat")).toFixed(3),c=parseFloat(localStorage.getItem("lon")).toFixed(3);navigator.geolocation.getCurrentPosition(function(d){return b===d.coords.latitude.toFixed(3)&&c===d.coords.longitude.toFixed(3)&&localStorage.getItem("location")?void Tab.locationData():(localStorage.setItem("lat",d.coords.latitude),localStorage.setItem("lon",d.coords.longitude),a=new XMLHttpRequest,a.open("GET","http://maps.googleapis.com/maps/api/geocode/json?latlng="+d.coords.latitude+","+d.coords.longitude+"&sensor=true",!0),a.onload=function(){if(a.status>=200&&a.status<400){var b=JSON.parse(a.responseText),c=_.find(b.results,function(a){return"postal_code"==a.types[0]});localStorage.setItem("location",JSON.stringify(c)),Tab.getWoeid(c.address_components[1].long_name.replace(/ /g,"%20")+"%20"+c.address_components[c.address_components.length-1].long_name)}else console.log("error status")},a.onerror=function(){console.log("error")},void a.send())})}},Tab.getWoeid=function(a){"use strict";var b,c;navigator.geolocation.getCurrentPosition(function(){b=new XMLHttpRequest,b.open("GET","http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20geo.places%20where%20text%3D%22"+a+"%22&format=json",!0),b.onload=function(){b.status>=200&&b.status<400?(c=JSON.parse(b.responseText),localStorage.setItem("woeid",c.query.results.place[0].woeid),Tab.locationData()):console.log("error status")},b.onerror=function(){console.log("error")},b.send()})},Tab.init=function(){Tab.showTime(),Tab.getLocation()},Tab.init();